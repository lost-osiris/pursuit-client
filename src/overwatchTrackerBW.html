<html>
<p> Track Overwatch </p>
  <script type="text/javascript">
    const electron = require('electron');
    const tasklist = require('tasklist');
    const os = require('os');

    const platform = os.platform();
    const ipc = electron.ipcRenderer;
    const checkFrequency = 15000;
    let userId = null;
    let checkInterval = null;

    if (platform === 'win32') {
      checkInterval = setInterval(() => {
        tasklist({ filter: ['imagename eq Overwatch.exe'] }).then((tasks) => {
          // console.log(tasks);
          let running = false;
          tasks.forEach((task) => {
            if (task && userId !== null) {
              running = true;
              console.log('start');
              ipc.send('start-capture', userId);
            }
          });
          if (!running) {
            console.log('stop');
            ipc.send('stop-capture');
          }
        }).catch(err => console.log(err));
      }, checkFrequency);
    }

    ipc.on('sign-in', (event, uid) => {
      console.log('sign-in', uid);
      userId = uid;
    });

    ipc.on('sign-out', (event, uid) => {
      console.log('sign-out', uid);
      userId = null;
      ipc.send('stop-capture');
    });

    ipc.on('close', (event) => {
      clearInterval(checkInterval);
      window.close();
    });

  </script>
</html>
