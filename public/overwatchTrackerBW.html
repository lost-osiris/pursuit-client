<html>
  <p> Track Overwatch </p>
  <script type="text/javascript">
    const path = require('path');
    require('dotenv').config({ path: path.join(__dirname, '../.env') });
    const electron = require('electron');
    const tasklist = require('tasklist');
    const os = require('os');
    const Sentry = require('@sentry/electron');

    Sentry.init({ dsn: process.env.REACT_APP_SENTRY_DSN });

    const platform = os.platform();
    const ipc = electron.ipcRenderer;
    const checkFrequency = 15000;
    let checkInterval = null;

    if (platform === 'win32') {
      checkInterval = setInterval(() => {
        tasklist({ filter: ['imagename eq Overwatch.exe'] }).then((tasks) => {
          // console.log(tasks);
          let running = false;
          tasks.forEach((task) => {
            if (task) {
              running = true;
              console.log('start');
              ipc.send('start-capture');
            }
          });
          if (!running) {
            console.log('stop');
            ipc.send('stop-capture');
          }
        }).catch(err => {
          console.log(err);
          Sentry.captureException(err);
        });
      }, checkFrequency);
    }

    ipc.on('close', (event) => {
      clearInterval(checkInterval);
      window.close();
    });

  </script>
</html>
